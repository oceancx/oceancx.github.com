

<!DOCTYPE html>
<html lang="cn">
  <head>
    <meta charset="utf-8">
    <title>重拾C/C++感想(上)</title>
    
    
    <meta name="author" content="Ocean-藏心">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="/css/typo.css" rel="stylesheet">
    <link href="/css/solarized.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/datatables-bootstrap.css" rel="stylesheet">
    <link href="/css/site.css" rel="stylesheet">

    <!-- javascript files -->
    <script type="text/javascript" src="/js/jquery-2.0.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/js/datatables-bootstrap.js"></script>
    <script type="text/javascript" src="/js/site.js"></script>

    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    <script type="text/javascript">
    </script>

  </head>

  <body id="scroll-pane" data-spy="scroll" data-target="#time-list-nav">
    <div class="wrapper">
      <!-- 导航条 -->
      <div class="nav navbar-nav" id="nav-wrap">
        <div class="navbar-header">
          <div class="col-md-2">
          </div>
          <div class="col-md-8">
            <a class="navbar-brand" href="/">
              <span class="site-author"> Ocean-藏心 </span>
              <span class="site-title"> /* 做个合格的程序员 */ </span>
            </a>
            <ul id="nav-menu" class="nav navbar-nav">
              
              
              





<li class="posts"><a href="/posts.html">文章</a></li>
<li class="timeline"><a href="/timeline.html">归档</a></li>
<li class="categories"><a href="/categories.html">目录</a></li>
<li class="about"><a href="/about.html">关于</a></li>

            </ul>
          </div>
          <div class="col-md-2">
          </div>
        </div>
      </div>

      <!-- 正文 -->
      

<div class="row post-full typo">
  <div class="col-md-2"></div>
  <div class="col-md-8 typo">
    <h2>重拾C/C++感想(上) </h2>
    <div class="post_info">
      
    </div>
    <div class="content">
      <p>最近觉得做android没啥意思了,就想着写JAVA这么久,
会不会对一些现成的东西产生依赖了,变得越来越懒了.
于是就重拾C/C++,开始自虐了.</p>

<p>最先就是写个hello world,咦,不错不错,还能用vim把hello world给搞通.
然后就是挑战一下曾经面试失利的快排,这就有点不容易了,
中途发现自己的Vim太难用了,就又去耗子哥的博客里面冲冲电,
又根据朋友的博客里面的Vim配置,给简单的配置了一下.才开始写
写着写着,思路是想好了,但是有点想睡觉了,就睡过去了.
第二天去公司上班,想着快排思路已经有了,写出来不还是那样子,
跟以前一样,以前也不知道写过多少遍了,把有限的时间放在实现更有挑战性的事情上把.
之前,我一直是想写个JSON解析呐,于是中午午睡的时候,就试着写了一会.主要就是调试了一会输入输出
接着就周末了,周六睡了一天,周日(今天)晚上,就又想起这事儿了.
于是就又开始写了,还没写个二十分钟,心里就各种吐槽C++,
JAVA写了1年多了,终于接受了面向对象的思想.
于是这次再次开写C/C++,就想着先封装一个栈玩玩,不能再像以前一样,
搞个数组加个top变量,写在main函数外边就行了.
谁知道C++的语法忘得差不多了,写起来真难 - -,老是编译不通过.
查了C++Primer半天,也捉急半天.后来想着C里面的typedef struct,跟C++ struct
语法的,总算是编译通过了,后来就又加入了,push,pop,clear,print成员方法.
心情算是好点了.</p>

<pre><code>struct Stack{
    char stack[JSON_STR_LENGTH];
    int top;
    public:
    void push(char c){
        stack[top++]=c;
    }
     char pop(){
        return stack[top--];
    }
     void clear(){
        top=0;
    }
    void print(){
        for(int i=0;i&lt;top;i++){
            putchar(stack[i]);
        }
        putchar('\n');
    }
};
</code></pre>

<p>然后又定义了几个常量:</p>

<pre><code>#define JSON_STR_LENGTH  1000
char jsonstr[JSON_STR_LENGTH];
void echo(char* str);
const char COLON=':';
const char BRACE_LEFT='{';
const char BRACE_RIGHT='}';
const char BRACKET_LEFT='[';
const char BRACKET_RIGHT=']';
const char COMMA =',';
const char D_QUOTES='"';
</code></pre>

<p>接下来就发现源文件太长了,打开vim后,离main函数太远了,这时就想着要把源文件给分割成小文件了.</p>

<p>于是就变成了这三个文件了 cjson.cc  globe.h   stack.h</p>

<p>不错,分割后,编译器一次通过,没啥乱子,感觉还不错.</p>

<p>刚开始做,肯定是先实现最简单的功能.
于是我的第一个任务是对源文件中的空白符进行处理.
于是写了两个小函数:</p>

<pre><code>bool is_white(char c){
    if(c==' '|| c=='\n' || c=='\t'){
        return true;
    }
    return false;
}
char* skip_white(char *s ){
    char*p = s;
    while(p!=NULL){
        char c= *p;
        if(is_white(c)){
            p++;
        }else{
            break;
        }
    }
    return p;
}
</code></pre>

<p>对此,我的感触是,在C++里面,指针比数组好用多了.
稍微有点体会到了指针的好用跟滥用的矛盾了.
这就是俺的trim逻辑:</p>

<pre><code>char* pjson=jsonstr;
index=0;
for(;*pjson!='\0';pjson++){
    char c= *pjson;
    if(is_white(c)){
        pjson=skip_white(pjson);
    }
    jsonstr[index++]=*pjson;
//  putchar(*pjson);
}
jsonstr[index]='\0';
</code></pre>

<p>把指针值传入到skip_white函数中,然后skip_white返回新的指针位置,
这比用下标方便多了.</p>

<pre><code>for(int i=0;i&lt;strlen(jsonstr);i++)
</code></pre>

<p>接下来就可以拿着新的数组来解析啦:</p>

<pre><code>// trim Json  完毕
/*
对JSON串进行解析 输入key val对
利用栈 先逐个字符读入,然后匹配
*/
Stack s;
pjson = jsonstr;
for(;*pjson!='\0';pjson++){
    char c=*pjson;
    switch c:
    case ':':
        break;
    case '{':
        break;
    case '}':
        break;
    case '[':
        break;
    case ']':
        break;
    case ',':
        break;
    case '\"':
        break;
}
</code></pre>

<p>我先搭了个框出来,对jsonstr的处理肯定要用到栈,
利用{,},[,]的配对关系,设定好锚点,缩小处理范围.
这之后,我盯着屏幕足足有10分钟,因为我无从下手,
也罢,起身入厕,就在我站在厕所里的时候,突然灵光一现.
瞬间把解析JSON的算法跟数据结构想通了.
因为我想到了树这种数据结构,
接着一切都变得清晰起来.
JSON的结构不就是个树吗</p>

<pre><code>          key:val
       	     |			
        /            \
    JSON            JSONARRAY
    |                    |        
 key:val        /    / ...   \    
              JSON  JSON  ... JSON
              |        |         |
            key:val key:val   key:val
</code></pre>

<p>这样,利用[] {} 的配对和栈,先把整个树给搭起来,
然后再对树里面的key:val进行解析,问题岂不是迎刃而解.
由于val有可能是整形,有可能是字符串,C++并不像java有个万能的Object,
如果用一个变量名来表示这两种数据类型,这也是个问题.
深思过后,val不过是一段连续的0和1而已,字符串,整形不也是么.
因此只要用指针,开辟不同长度的内存即可完成对这两种数据类型的存储.
而对于这些的讨论,我会放到下篇来讲.
结束前,我发现通过思考这个解析问题,让我的C/C++技术里面一些重要的东西
都串起来了.指针,栈,树,内存分配,等等.不错不错,新的研究方向终于点燃起我的热情了.</p>

<p><a href="https://github.com/oceancx/cjson">代码</a>  <a href="http://blog.oceancx.com/2015/12/05/review-c++-2">下篇</a></p>


    </div>

    

    <hr>
      <ul class="pagination pull-right">
        
        <li class="prev"><a href="/2015/11/17/BASH%E5%A4%87%E5%BF%98" title="Bash备忘">&larr; 前一篇</a></li>
        
        <li><a href="/posts.html">索引</a></li>
        
        <li class="next"><a href="/2015/12/05/review-c++-2" title="重拾C/C++感想(下)">后一篇 &rarr;</a></li>
        
      </ul>
    <br />
    <div id="comment-hook"></div>
    


  <!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key='/2015/11/29/review-c++-1' data-title='重拾C/C++感想(上)' data-url='http://blog.oceancx.com/2015/11/29/review-c++-1'></div>
<!-- 多说评论框 end -->
<script type="text/javascript">
    var duoshuo_developer = 1;
    var duoshuo_shortname = 'oceancx'; // required: replace example with your forum shortname
    

    var duoshuoQuery = {short_name:"oceancx"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>




  </div>
  <div class="col-md-2"></div>
</div>



    </div>
    <!-- 底部声明 -->
    <div class="row bottom">
      <div class="col-md-2">
      </div>
      <div class="col-md-8 text-center">
        &mdash;&nbsp;&nbsp;<a href="https://github.com/oceancx" class="license">Github</a>&nbsp;&nbsp;&mdash;
      </div>
      <div class="col-md-2">
      </div>
    </div>

    

  </body>
</html>

